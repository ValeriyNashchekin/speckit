# Feature Specification: Family Library Phase 3

**Feature Branch**: `003-family-library-phase3`
**Created**: 2026-02-17
**Status**: Draft
**Input**: Family Library Phase 3 ‚Äî Nested Families, Complex System Families, Material Mapping
**Depends On**: `002-family-library-phase2`

---

## Overview

Phase 3 –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É Family Library –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:

1. **Nested Families** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞–º–∏
2. **Complex System Families** ‚Äî Railings, Stairs, Curtain Systems, Cable Trays
3. **–°–µ—Ä–≤–µ—Ä–Ω—ã–π Material Mapping** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –º–µ–∂–¥—É —à–∞–±–ª–æ–Ω–æ–º –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

---

## Scope Summary

### Module 8: Nested Families

#### –¢–∏–ø—ã –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | Shared? | –í–∏–¥–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ? |
|-----|----------|---------|---------------------------|
| **Nested (–Ω–µ Shared)** | –í–ª–æ–∂–µ–Ω–æ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ, –Ω–µ –≤–∏–¥–Ω–æ —Å–Ω–∞—Ä—É–∂–∏ | –ù–µ—Ç | –ù–µ—Ç ‚Äî –Ω–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è—Ö, –Ω–µ —Ç–µ–≥–∏—Ä—É–µ—Ç—Å—è |
| **Nested Shared** | –í–ª–æ–∂–µ–Ω–æ, –Ω–æ –≤–∏–¥–Ω–æ –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç | –î–∞ | –î–∞ ‚Äî –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è—Ö, —Ç–µ–≥–∏—Ä—É–µ—Ç—Å—è, —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |

**–ö–ª—é—á–µ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Revit:**
- Shared —Å–µ–º–µ–π—Å—Ç–≤–æ, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –≤ –ø—Ä–æ–µ–∫—Ç, –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ non-shared –≤–µ—Ä—Å–∏—é –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
- –ï—Å–ª–∏ Parent_A –∏ Parent_B —Å–æ–¥–µ—Ä–∂–∞—Ç `Leg_v1` –∫–∞–∫ Shared ‚Üí –≤ –ø—Ä–æ–µ–∫—Ç–µ **–æ–¥–Ω–∞** –∫–æ–ø–∏—è `Leg_v1`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `Leg_v1` —á–µ—Ä–µ–∑ –æ–¥–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –æ–±–Ω–æ–≤–∏—Ç –µ–≥–æ –∏ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã

1. **–ö–∞–∂–¥–æ–µ Shared –≤–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** —Å–æ —Å–≤–æ–µ–π —Ä–æ–ª—å—é, –≤–µ—Ä—Å–∏–µ–π, —Ö–µ—à–µ–º
2. **Non-Shared –≤–ª–æ–∂–µ–Ω–Ω—ã–µ ‚Äî —á–∞—Å—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ**, –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
3. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–µ–º–µ–π—Å—Ç–≤–∞
4. **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏**: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ (Revit –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Å–∞–º), –Ω–æ –º—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º –≤–µ—Ä—Å–∏–∏

**–î–æ–ª–∂–Ω–æ –ª–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –∏–º–µ—Ç—å —Ä–æ–ª—å?**

| –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ä–æ–ª—å? | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----|-------------------|-------------|
| Shared nested | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** | –í–∏–¥–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ |
| Non-Shared nested | **–ù–µ—Ç** | –ù–µ –≤–∏–¥–Ω–æ, –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ |

#### –§–∏—á–∏ –º–æ–¥—É–ª—è

| –§–∏—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| Shared Nested Detection | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Shared –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–µ–º–µ–π—Å—Ç–≤ –ø—Ä–∏ Publish |
| Dependency Tracking | –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–æ–¥–∏—Ç–µ–ª—è |
| Load Order | –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (parent ‚Üí nested) |
| Version Conflicts | UI –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö |
| "Used In" UI | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–¥–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

### System Families Groups C, D

| –ì—Ä—É–ø–ø–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|-----------|-----------|
| **C** | Railings, Stairs, Top Rails, Handrails | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Loadable |
| **D** | Curtain Walls, Curtain Systems, Mullions | –°–µ—Ç–∫–∞, –ø–∞–Ω–µ–ª–∏, –ø—Ä–æ—Ñ–∏–ª–∏ |
| **B (extended)** | Cable Trays, Conduits | MEP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ |

### Material Mapping Server

| –§–∏—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| MaterialMapping table | TemplateMaterialName ‚Üí ProjectMaterialName |
| Auto-mapping | –ü—Ä–∏ Pull Update –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ |
| Manual override | UI –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞ |

---

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Manage Nested Families (Priority: P1)

–ö–∞–∫ –ë–ò–ú-–º–µ–Ω–µ–¥–∂–µ—Ä, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –∫–∞–∫–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–µ–º–µ–π—Å—Ç–≤–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

**Acceptance Scenarios**:

1. –ü—Ä–∏ Publish —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–µ–º–µ–π—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç Shared nested families
2. –í Tab 2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ "Dependencies" —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö
3. –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏ (–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ / –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ)
4. Warning –µ—Å–ª–∏ Shared nested –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

### User Story 2 - Load Family with Nested (Priority: P1)

–ö–∞–∫ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫, —è —Ö–æ—á—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–º–µ–π—Å—Ç–≤–æ —Å–æ –≤—Å–µ–º–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏, —á—Ç–æ–±—ã –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**Acceptance Scenarios**:

1. Pre-Load Summary –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∏ –∏—Ö –≤–µ—Ä—Å–∏–∏
2. –ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å nested –±–æ–ª–µ–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç—å
3. –ï—Å–ª–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ nested –±–æ–ª–µ–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —á–µ–º –≤ RFA ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
4. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### User Story 3 - Manage Complex System Families (Priority: P2)

–ö–∞–∫ –ë–ò–ú-–º–µ–Ω–µ–¥–∂–µ—Ä, —è —Ö–æ—á—É —É–ø—Ä–∞–≤–ª—è—Ç—å Railings –∏ Curtain Walls –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ.

**Acceptance Scenarios**:

1. RailingType —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è —Å dependencies –Ω–∞ Loadable Families (balusters)
2. Pull Update –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∑–∞–≤–∏—Å–∏–º—ã—Ö Loadable Families –≤ –ø—Ä–æ–µ–∫—Ç–µ
3. Curtain Wall —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è —Å grid, panels, mullions
4. Stacked Wall —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–µ WallType

### User Story 4 - Auto Material Mapping (Priority: P2)

–ö–∞–∫ –ë–ò–ú-–º–µ–Ω–µ–¥–∂–µ—Ä, —è —Ö–æ—á—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, —á—Ç–æ–±—ã –ø—Ä–∏ Pull Update –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–ª–∏—Å—å.

**Acceptance Scenarios**:

1. –¢–∞–±–ª–∏—Ü–∞ MaterialMapping: TemplateMaterialName ‚Üí ProjectMaterialName
2. –ü—Ä–∏ Pull Update –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞–ø–ø—è—Ç—Å—è
3. –ï—Å–ª–∏ –º–∞–ø–ø–∏–Ω–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è warning —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤—ã–±–æ—Ä–∞
4. UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–ø–ø–∏–Ω–≥–∞–º–∏ (CRUD)
5. –ú–∞–ø–ø–∏–Ω–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è per-project (—Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã ‚Äî —Ä–∞–∑–Ω—ã–µ –º–∞–ø–ø–∏–Ω–≥–∏)

### User Story 5 - See "Used In" for Nested Families (Priority: P2)

–ö–∞–∫ –ë–ò–ú-–º–µ–Ω–µ–¥–∂–µ—Ä, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –≤ –∫–∞–∫–∏—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ–º–µ–π—Å—Ç–≤–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω–æ–µ, —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

**Acceptance Scenarios**:

1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Å–µ–º–µ–π—Å—Ç–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –≤"
2. –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ, –≤–µ—Ä—Å–∏—è –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ, –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
3. Warning –µ—Å–ª–∏ –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ –≤–ª–æ–∂–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
4. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü—É

### User Story 6 - Resolve Nested Version Conflicts (Priority: P1)

–ö–∞–∫ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫, —è —Ö–æ—á—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–µ–º–µ–π—Å—Ç–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ.

**Acceptance Scenarios**:

1. –ü—Ä–∏ Load to Project –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Pre-Load Summary —Å–æ –≤—Å–µ–º–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ nested –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: –≤–µ—Ä—Å–∏—è –≤ RFA, –≤–µ—Ä—Å–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ, –≤–µ—Ä—Å–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. –ï—Å–ª–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –≤–µ—Ä—Å–∏—è –Ω–æ–≤–µ–µ —á–µ–º –≤ RFA ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ "–û–±–Ω–æ–≤–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"
4. –ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –≤–µ—Ä—Å–∏—è —Å—Ç–∞—Ä–µ–µ —á–µ–º –≤ RFA ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ "–û–±–Ω–æ–≤–∏—Ç—å –¥–æ –≤–µ—Ä—Å–∏–∏ –∏–∑ RFA"
5. –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ nested –æ—Ç–¥–µ–ª—å–Ω–æ

---

## Requirements *(mandatory)*

### Functional Requirements

**–ú–æ–¥—É–ª—å 8: Nested Families**

- **FR-301**: –ü—Ä–∏ Publish –î–û–õ–ñ–ï–ù –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ Shared nested families
- **FR-302**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –î–û–õ–ñ–ù–´ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–æ–¥–∏—Ç–µ–ª—è
- **FR-303**: UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –î–û–õ–ñ–ï–ù –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–µ–π–¥–∂ üîó –¥–ª—è —Å–µ–º–µ–π—Å—Ç–≤ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **FR-304**: Pre-Load Summary –î–û–õ–ñ–ï–ù –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ nested (–≤ RFA vs –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ vs –≤ –ø—Ä–æ–µ–∫—Ç–µ)
- **FR-305**: IFamilyLoadOptions.OnSharedFamilyFound –î–û–õ–ñ–ï–ù –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ nested
- **FR-306**: Nested —Å–µ–º–µ–π—Å—Ç–≤–æ –ë–ï–ó —Ä–æ–ª–∏ –î–û–õ–ñ–ù–û –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è —Å roleName: null
- **FR-307**: –°–∫–∞–Ω–µ—Ä –î–û–õ–ñ–ï–ù –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É "Nested In" –¥–ª—è Shared nested
- **FR-308**: "Used In" UI –î–û–õ–ñ–ï–ù –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–≤—è–∑–∏ (–≥–¥–µ nested –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- **FR-309**: –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –î–û–õ–ñ–ï–ù –±—ã—Ç—å: parent ‚Üí nested override (—Å–Ω–∞—á–∞–ª–∞ –∏–∑ RFA, –ø–æ—Ç–æ–º –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
- **FR-310**: Stamp —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ù–ï –î–û–õ–ñ–ï–ù –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∏—Å–∞—Ç—å ES –≤ nested
- **FR-311**: Non-Shared nested –î–û–õ–ñ–ù–´ –æ—Ç–º–µ—á–∞—Ç—å—Å—è isShared: false, –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä–æ–ª–∏

**System Families Groups C, D**

- **FR-321**: RailingType –î–û–õ–ñ–ï–ù —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è —Å railingStructure –∏ dependencies
- **FR-322**: StairType –î–û–õ–ñ–ï–ù –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è (Phase 3 scope)
- **FR-323**: CurtainWallType –î–û–õ–ñ–ï–ù —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è —Å grid/panels/mullions
- **FR-324**: StackedWallType –î–û–õ–ñ–ï–ù —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–µ WallType
- **FR-325**: Pull Update –î–û–õ–ñ–ï–ù –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –∑–∞–≤–∏—Å–∏–º—ã—Ö Loadable Families
- **FR-326**: –ï—Å–ª–∏ —Ç–∏–ø –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ ‚Äî –î–û–õ–ñ–ï–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Duplicate –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ç–∏–ø–∞

**Material Mapping**

- **FR-331**: –¢–∞–±–ª–∏—Ü–∞ MaterialMapping –î–û–õ–ñ–ù–ê —Ö—Ä–∞–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥–∏ per project
- **FR-332**: –ü—Ä–∏ Pull Update –î–û–õ–ñ–ï–ù –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ-–º–∞–ø–ø–∏–Ω–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- **FR-333**: UI –î–û–õ–ñ–ï–ù –ø–æ–∑–≤–æ–ª—è—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å –º–∞–ø–ø–∏–Ω–≥–∞–º–∏ (CRUD)
- **FR-334**: –ï—Å–ª–∏ –º–∞–ø–ø–∏–Ω–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –î–û–õ–ñ–ù–´ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã: –í—ã–±—Ä–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π / –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π / Default / –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
- **FR-335**: –£–¥–∞–ª–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –î–û–õ–ñ–ù–û —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

### Key Entities

- **FamilyDependency**: ParentFamilyId, NestedFamilyName, NestedRoleName, IsShared, InLibrary, LibraryVersion
- **MaterialMapping**: TemplateMaterialName, ProjectMaterialName, ProjectId, CreatedAt

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-301**: 95% Nested families –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **SC-302**: Material Mapping –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 80% —Ç–∏–ø–æ–≤—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **SC-303**: Complex System Families –ø–æ–∫—Ä—ã–≤–∞—é—Ç 90% —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## Technical Context

### JSON Structure (Group C - Railings)

```json
{
  "typeName": "Railing_Glass_900",
  "category": "Railings",
  "systemFamily": "Railing",
  "parameters": { "Height": 900 },
  "railingStructure": {
    "topRailTypeName": "Circular - 50mm",
    "balusterPlacement": {
      "pattern": [{ "balusterFamilyName": "Baluster-Round", "balusterTypeName": "25mm" }]
    }
  },
  "dependencies": [
    { "familyName": "Baluster-Round", "typeName": "25mm", "inLibrary": true }
  ]
}
```

### JSON Structure (Group D - Curtain Wall)

```json
{
  "typeName": "Curtain_Wall_Storefront",
  "kind": "Curtain",
  "grid": { "horizontalSpacing": 1200, "verticalSpacing": 2400 },
  "panels": { "defaultPanelTypeName": "System Panel" },
  "mullions": { "horizontalMullion": "Rectangular Mullion", "verticalMullion": "Rectangular Mullion" }
}
```

### JSON Structure (Stacked Wall)

```json
{
  "typeName": "Stacked_External",
  "kind": "Stacked",
  "stackedLayers": [
    { "wallTypeName": "Wall_Lower_Concrete", "height": 1200 },
    { "wallTypeName": "Wall_Upper_Brick", "height": 0 }
  ]
}
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** –ø—Ä–∏ Pull Update –Ω—É–∂–Ω—ã –æ–±–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö WallType –≤ –ø—Ä–æ–µ–∫—Ç–µ.

### –¢–∞–±–ª–∏—Ü–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π System Families

| –ì—Ä—É–ø–ø–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Loadable Families |
|--------|----------------------------------|
| A (CompoundStructure) | –ù–µ—Ç |
| B (MEP) | –§–∏—Ç–∏–Ω–≥–∏ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| C (Railings/Stairs) | **–î–∞**: –±–∞–ª—è—Å–∏–Ω—ã, —Å—Ç–æ–π–∫–∏, –ø—Ä–æ—Ñ–∏–ª–∏ |
| D (Curtain) | **–î–∞**: –ø–∞–Ω–µ–ª–∏ (–µ—Å–ª–∏ Loadable), –ø—Ä–æ—Ñ–∏–ª–∏ |
| E (–ü—Ä–æ—Å—Ç—ã–µ) | –ù–µ—Ç |

### Pull Update Flow –¥–ª—è System Families

**–ï—Å–ª–∏ —Ç–∏–ø –°–£–©–ï–°–¢–í–£–ï–¢ –≤ –ø—Ä–æ–µ–∫—Ç–µ:**
- –ì—Ä—É–ø–ø–∞ A: –°–æ–∑–¥–∞—Ç—å CompoundStructure –∏–∑ JSON, –Ω–∞–π—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∏–º–µ–Ω–∏, SetCompoundStructure()
- –ì—Ä—É–ø–ø–∞ B: –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã + RoutingPreferences
- –ì—Ä—É–ø–ø–∞ C: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Loadable Families), –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ì—Ä—É–ø–ø–∞ D: –û–±–Ω–æ–≤–∏—Ç—å grid/panels/mullions
- –ì—Ä—É–ø–ø–∞ E: –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ï—Å–ª–∏ —Ç–∏–ø–∞ –ù–ï–¢ –≤ –ø—Ä–æ–µ–∫—Ç–µ:**
1. –ù–∞–π—Ç–∏ –ª—é–±–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∏–ø —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. Duplicate(newName)
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã/—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ JSON
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –æ–¥–∏–Ω —Ç–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –û—à–∏–±–∫–∞: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∏–ø: –Ω–µ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è"

### API Endpoints (Additions)

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/families/{id}/dependencies` | GET | –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| `/api/families/{id}/used-in` | GET | –ì–¥–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `/api/material-mappings` | GET/POST/PUT/DELETE | CRUD –º–∞–ø–ø–∏–Ω–≥–æ–≤ |

---

## Detailed Technical Specifications

### Nested Families: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```json
{
  "familyName": "FreeAxez_Table",
  "roleName": "FreeAxez_Table",
  "dependencies": [
    {
      "familyName": "FreeAxez_Table_Leg",
      "category": "Furniture",
      "isShared": true,
      "roleName": "FreeAxez_Table_Leg",
      "inLibrary": true,
      "libraryVersion": 3
    },
    {
      "familyName": "InternalBracket",
      "category": "Generic Models",
      "isShared": false,
      "roleName": null,
      "inLibrary": false
    }
  ]
}
```

### Nested Families: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á—ë—Ç–æ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö

**ParentContentHash = SHA256(NormalizedPartAtomXML(Parent))**

**–ù–ï –≤–∫–ª—é—á–∞—Ç—å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤ —Ö–µ—à —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ:
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–º–µ—é—Ç —Å–≤–æ–∏ –≤–µ—Ä—Å–∏–∏ –∏ —Ö–µ—à–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ
- PartAtom XML —Å–æ–¥–µ—Ä–∂–∏—Ç **–∏–º–µ–Ω–∞** –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ ‚Üí —Ö–µ—à –∏–∑–º–µ–Ω–∏—Ç—Å—è, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ:**

| –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è Parent? |
|-----------|---------------------|
| –ò–∑–º–µ–Ω–∏–ª–∞—Å—å –≥–µ–æ–º–µ—Ç—Ä–∏—è/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã Parent | –î–∞ |
| –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –≤–ª–æ–∂–µ–Ω–Ω–æ–µ Shared —Å–µ–º–µ–π—Å—Ç–≤–æ | **–ù–µ—Ç** (—É –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Å–≤–æ—è –≤–µ—Ä—Å–∏—è) |
| –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ | –î–∞ (PartAtom –∏–∑–º–µ–Ω–∏—Ç—Å—è) |
| –£–¥–∞–ª–µ–Ω–æ/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ | –î–∞ (PartAtom –∏–∑–º–µ–Ω–∏—Ç—Å—è) |

### Nested Families: IFamilyLoadOptions –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

```csharp
public bool OnSharedFamilyFound(
    Family sharedFamily,
    bool familyInUse,
    out FamilySource source,
    out bool overwriteParameterValues)
{
    // –í–ª–æ–∂–µ–Ω–Ω–æ–µ Shared –Ω–∞–π–¥–µ–Ω–æ ‚Äî –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å?
    // FamilySource.Family = –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ RFA
    // FamilySource.Project = –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ, —á—Ç–æ —É–∂–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

    if (userChoseLibraryVersion)
    {
        source = FamilySource.Project; // –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é, –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º
    }
    else
    {
        source = FamilySource.Family; // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ RFA
    }

    overwriteParameterValues = true;
    return true;
}
```

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–∂–µ–Ω:** —Å–Ω–∞—á–∞–ª–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ, –ø–æ—Ç–æ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ (—á—Ç–æ–±—ã –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –∏–∑ RFA).

### Nested Families: Pre-Load Summary UI

```
–ó–∞–≥—Ä—É–∑–∫–∞ FreeAxez_Table v4

–ë—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã:
‚Ä¢ FreeAxez_Table (–æ—Å–Ω–æ–≤–Ω–æ–µ)
‚Ä¢ FreeAxez_Table_Leg (–≤–ª–æ–∂–µ–Ω–Ω–æ–µ Shared) ‚Äî v3
  ‚ö† –í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å v2. –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–æ v3.
‚Ä¢ FreeAxez_Handle (–≤–ª–æ–∂–µ–Ω–Ω–æ–µ Shared) ‚Äî v1
  –ù–æ–≤–æ–µ, –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤–ø–µ—Ä–≤—ã–µ.

[Load All] [Load –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö] [Cancel]
```

### Nested Families: "Used In" UI

```
FreeAxez_Table_Leg ‚Äî Furniture
Version: 5

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –≤:
| –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ         ‚îÇ –í–ª–æ–∂–µ–Ω–∞ –≤–µ—Ä—Å–∏—è ‚îÇ –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è ‚îÇ
|----------------------|----------------|---------------------------|
| FreeAxez_Table       ‚îÇ v3             ‚îÇ v4                        |
| FreeAxez_WorkDesk    ‚îÇ v5             ‚îÇ v2                        |

‚ö† –í FreeAxez_Table –≤–ª–æ–∂–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (v3).
```

### Nested Families: Stamp –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ

- **Stamp —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ**: –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç ES **—Ç–æ–ª—å–∫–æ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ**
- **Stamp –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ**: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ**
- –ü—Ä–∏ Stamp —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ ‚Üí **–Ω–µ** –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å ES –≤ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø—Ä–∏ Stamp:**
```
–ü—Ä–∏ Stamp FreeAxez_Table:

1. –ó–∞–ø–∏—Å–∞—Ç—å ES –≤ FreeAxez_Table
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Shared –≤–ª–æ–∂–µ–Ω–Ω—ã–µ:
   - FreeAxez_Table_Leg: –µ—Å—Ç—å ES? ‚Üí OK
   - FreeAxez_Handle: –Ω–µ—Ç ES ‚Üí Info: "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å Stamp –æ—Ç–¥–µ–ª—å–Ω–æ."
3. –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Stamp —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ
```

### Material Mapping: Fallback –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–∏ Pull Update, –µ—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏ –º–∞–ø–ø–∏–Ω–≥ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω:

```
Warning: "–ú–∞—Ç–µ—Ä–∏–∞–ª '[–∏–º—è]' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ"

–í–∞—Ä–∏–∞–Ω—Ç—ã:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [–í—ã–±—Ä–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π] ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞    ‚îÇ
‚îÇ [–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π] ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª —Å –Ω—É–∂–Ω—ã–º –∏–º–µ–Ω–µ–º   ‚îÇ
‚îÇ [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Default] ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚îÇ
‚îÇ [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å] ‚Äî –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å–ª–æ–π (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –Ω–µ–≥–æ)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

---

## Out of Scope

- In-Place Families
- Linked Models families
- Custom geometry generation

---

## Dependencies

- **Requires**: `002-family-library-phase2`
- Revit API –¥–ª—è Curtain Systems, Railings, Stairs
- Expanded dependency tracking in DB

---

## Edge Cases

### Nested Families

| –°–ª—É—á–∞–π | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –ù–µ–≤–æ–∑–º–æ–∂–Ω—ã –≤ Revit, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å |
| –ì–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å (A‚ÜíB‚ÜíC) | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥, Revit –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| –û–¥–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö | –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚Üí –æ–±–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª—É—á–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (Shared!) |
| Non-Shared —Å—Ç–∞–ª–æ Shared | ContentHash —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è ‚Üí –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è |
| –í–ª–æ–∂–µ–Ω–Ω–æ–µ –±–µ–∑ —Ä–æ–ª–∏ | –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `roleName: null`, –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |

### Complex System Families

| –°–ª—É—á–∞–π | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| Railing –±–µ–∑ balusters –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ | Warning, –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ |
| Curtain Wall —Å Loadable –ø–∞–Ω–µ–ª—è–º–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–∞–Ω–µ–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å |
| Stacked Wall –±–µ–∑ –¥–æ—á–µ—Ä–Ω–∏—Ö WallType | Error: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–æ—á–µ—Ä–Ω–∏–µ —Ç–∏–ø—ã —Å—Ç–µ–Ω" |
| –ú–∞—Ç–µ—Ä–∏–∞–ª –∏–∑ JSON –Ω–µ –Ω–∞–π–¥–µ–Ω | Fallback –Ω–∞ Material Mapping + –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞ |

### Material Mapping

| –°–ª—É—á–∞–π | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–∞–ø–ø–∏–Ω–≥–æ–≤ (–¥–≤–∞ project –º–∞–ø–ø–∏–Ω–≥–∞ –Ω–∞ –æ–¥–∏–Ω template) | –ü–æ–∫–∞–∑–∞—Ç—å warning, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ –¥–∞—Ç–µ |
| –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª | Fallback –Ω–∞ MVP –ø–æ–≤–µ–¥–µ–Ω–∏–µ (warning + –≤–∞—Ä–∏–∞–Ω—Ç—ã) |
| –£–¥–∞–ª–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –º–∞–ø–ø–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π |

---

## Performance Targets

| –û–ø–µ—Ä–∞—Ü–∏—è | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö–æ–Ω—Ç–µ–∫—Å—Ç |
|----------|------------|----------|
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ nested –ø—Ä–∏ Publish | < 3 —Å–µ–∫ –Ω–∞ —Å–µ–º–µ–π—Å—Ç–≤–æ | EditFamily() + –∞–Ω–∞–ª–∏–∑ |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–º–µ–π—Å—Ç–≤–∞ —Å 5+ nested | < 15 —Å–µ–∫ | –°–∫–∞—á–∏–≤–∞–Ω–∏–µ + –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö |
| Batch –ø—Ä–æ–≤–µ—Ä–∫–∞ nested —Å—Ç–∞—Ç—É—Å–æ–≤ | < 2 —Å–µ–∫ –¥–ª—è 100 —Å–µ–º–µ–π—Å—Ç–≤ | API –∑–∞–ø—Ä–æ—Å |
| Pull Update System Family Group C | < 5 —Å–µ–∫ | –° –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| Material Mapping lookup | < 100 –º—Å | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Nested Families

**–ü—Ä–æ–±–ª–µ–º–∞:** `EditFamily()` ‚Äî —Ç—è–∂—ë–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (~1-3 —Å–µ–∫ –Ω–∞ —Å–µ–º–µ–π—Å—Ç–≤–æ).

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ Publish: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–æ–¥–∏–Ω —Ä–∞–∑)
- –í –ø—Ä–æ–µ–∫—Ç–µ: **–Ω–µ** –≤—ã–∑—ã–≤–∞—Ç—å EditFamily() –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ü–æ–ª—É—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ –±–∞–∑—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ RoleName
- –î–ª—è Legacy/Unmatched: –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
