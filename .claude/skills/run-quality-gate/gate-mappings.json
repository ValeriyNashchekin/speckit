{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Quality Gate Mappings",
  "description": "Configuration for quality gate commands and behavior for Angular 19 + .NET 10 stack",
  "gates": {
    "type-check": {
      "angular": {
        "command": "npm run type-check || ng build --aot --configuration production",
        "description": "TypeScript type checking for Angular",
        "typical_duration_ms": 5000,
        "error_patterns": [
          "error TS\\d+",
          "Type '.+' is not assignable",
          "Cannot find",
          "NG[0-9]+:"
        ]
      },
      "dotnet": {
        "command": "dotnet build --no-restore",
        "description": ".NET/C# compilation check",
        "typical_duration_ms": 10000,
        "error_patterns": [
          "error CS\\d+",
          "Cannot implicitly convert",
          "The type or namespace name",
          "BUILD FAILED"
        ]
      }
    },
    "build": {
      "angular": {
        "command": "ng build --configuration production",
        "description": "Angular production build",
        "typical_duration_ms": 30000,
        "error_patterns": [
          "ERROR in",
          "Module not found",
          "Build failed",
          "Compilation error",
          "NG[0-9]+:"
        ]
      },
      "dotnet": {
        "command": "dotnet publish -c Release --no-restore",
        "description": ".NET production build",
        "typical_duration_ms": 45000,
        "error_patterns": [
          "error CS\\d+",
          "Build FAILED",
          "NuGet package restore failed"
        ]
      }
    },
    "tests": {
      "angular": {
        "unit": {
          "command": "ng test --code-coverage --watch=false --browsers=ChromeHeadless",
          "description": "Angular unit tests (Jest)",
          "typical_duration_ms": 60000,
          "error_patterns": [
            "FAIL",
            "Tests failed",
            "Expected:",
            "Received:",
            "● "
          ]
        },
        "e2e": {
          "command": "ng e2e --headed=false",
          "description": "Angular E2E tests (Playwright)",
          "typical_duration_ms": 120000,
          "error_patterns": [
            "Error: Timed out",
            "Test failed",
            "Spec failed"
          ]
        }
      },
      "dotnet": {
        "command": "dotnet test --no-build --configuration Release --verbosity normal",
        "description": ".NET unit tests (xUnit/NUnit)",
        "typical_duration_ms": 30000,
        "error_patterns": [
          "Failed ",
          "Test Failed",
          "Expected:",
          "Actual:",
          "Stack Trace:"
        ]
      }
    },
    "lint": {
      "angular": {
        "command": "ng lint",
        "description": "Angular ESLint validation",
        "typical_duration_ms": 10000,
        "error_patterns": [
          "error -",
          "warning -",
          "✗ \\d+ problems"
        ]
      },
      "dotnet": {
        "command": "dotnet format --verify-no-changes --folder",
        "description": ".NET code style validation (dotnet format)",
        "typical_duration_ms": 8000,
        "error_patterns": [
          "formatted files",
          "File would be formatted"
        ]
      }
    },
    "migrations": {
      "dotnet": {
        "command": "dotnet ef migrations add __Temp__ --startup-project ../Web && dotnet ef migrations remove --force --startup-project ../Web",
        "description": "EF Core migration validation (creates and removes temp migration)",
        "typical_duration_ms": 15000,
        "error_patterns": [
          "Build failed",
          "error CS\\d+",
          "Could not create",
          "SQL error"
        ]
      }
    },
    "custom": {
      "command": null,
      "description": "Custom validation command (user-provided)",
      "typical_duration_ms": null,
      "error_patterns": [
        "error",
        "failed",
        "✗"
      ]
    }
  },
  "actions": {
    "continue": {
      "description": "Gate passed, continue workflow",
      "recommendation": "Proceed to next phase"
    },
    "stop": {
      "description": "Gate failed and is blocking, halt workflow",
      "recommendation": "Fix errors before proceeding"
    },
    "warn": {
      "description": "Gate failed but is non-blocking, log warning",
      "recommendation": "Note warning and continue, address later"
    }
  },
  "exit_codes": {
    "0": {
      "meaning": "Success",
      "passed": true
    },
    "1": {
      "meaning": "General error or test failures",
      "passed": false
    },
    "2": {
      "meaning": "Command line usage error",
      "passed": false
    },
    "127": {
      "meaning": "Command not found",
      "passed": false
    },
    "-1": {
      "meaning": "Timeout or internal error",
      "passed": false
    }
  },
  "timeout": {
    "milliseconds": 300000,
    "description": "5 minutes maximum execution time",
    "rationale": "Prevents indefinite hangs while allowing slow test suites"
  },
  "stack_detection": {
    "description": "Auto-detect project stack and use appropriate commands",
    "angular_indicators": [
      "angular.json",
      "package.json with @angular/core",
      "tsconfig.json"
    ],
    "dotnet_indicators": [
      "*.sln",
      "*.csproj",
      "project.json"
    ],
    "monorepo_indicators": [
      "pnpm-workspace.yaml",
      "package.json with workspaces",
      "nx.json",
      "turbo.json"
    ]
  }
}
