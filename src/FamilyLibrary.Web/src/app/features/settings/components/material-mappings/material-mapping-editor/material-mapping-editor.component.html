<p-dialog
  [header]="dialogTitle()"
  [visible]="visible()"
  [modal]="true"
  [closable]="true"
  [draggable]="true"
  [resizable]="false"
  [style]="{ width: '32rem' }"
  (onHide)="onHide()"
>
  <form [formGroup]="mappingForm" class="space-y-4">
    <!-- Template Material Name -->
    <div class="flex flex-col gap-2">
      <label for="templateMaterialName" class="text-sm font-medium text-gray-700">
        Template Material <span class="text-red-500">*</span>
      </label>
      <input
        pInputText
        id="templateMaterialName"
        formControlName="templateMaterialName"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('templateMaterialName')"
        [class.ng-dirty]="mappingForm.get('templateMaterialName')?.dirty"
        placeholder="e.g., Brick, Common"
        aria-describedby="templateMaterialNameError"
        [disabled]="isEditMode()"
      />
      @if (isFieldInvalid('templateMaterialName')) {
        <small id="templateMaterialNameError" class="text-red-500 text-xs">
          @if (mappingForm.get('templateMaterialName')?.errors?.['required']) {
            Template material name is required
          }
        </small>
      }
      @if (isEditMode()) {
        <small class="text-gray-400 text-xs">
          Template material name cannot be changed
        </small>
      }
    </div>

    <!-- Project Material Name -->
    <div class="flex flex-col gap-2">
      <label for="projectMaterialName" class="text-sm font-medium text-gray-700">
        Project Material <span class="text-red-500">*</span>
      </label>
      <input
        pInputText
        id="projectMaterialName"
        formControlName="projectMaterialName"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('projectMaterialName')"
        [class.ng-dirty]="mappingForm.get('projectMaterialName')?.dirty"
        placeholder="e.g., My Brick Red"
        aria-describedby="projectMaterialNameError"
      />
      @if (isFieldInvalid('projectMaterialName')) {
        <small id="projectMaterialNameError" class="text-red-500 text-xs">
          @if (mappingForm.get('projectMaterialName')?.errors?.['required']) {
            Project material name is required
          }
        </small>
      }
    </div>

    <!-- Category (optional) -->
    <div class="flex flex-col gap-2">
      <label for="category" class="text-sm font-medium text-gray-700">
        Category <span class="text-gray-400 text-xs font-normal">(optional)</span>
      </label>
      <input
        pInputText
        id="category"
        formControlName="category"
        class="w-full"
        placeholder="e.g., Masonry"
        aria-describedby="categoryError"
      />
      @if (isFieldInvalid('category')) {
        <small id="categoryError" class="text-red-500 text-xs">
          @if (mappingForm.get('category')?.errors?.['maxlength']) {
            Category cannot exceed 100 characters
          }
        </small>
      }
    </div>
  </form>

  <ng-template #footer>
    <div class="flex justify-end gap-2">
      <p-button
        label="Cancel"
        severity="secondary"
        [outlined]="true"
        (onClick)="onCancel()"
      />
      <p-button
        [label]="isEditMode() ? 'Update' : 'Create'"
        severity="primary"
        (onClick)="onSave()"
        [disabled]="mappingForm.invalid || isSubmitting()"
      />
    </div>
  </ng-template>
</p-dialog>
