<p-toast position="bottom-right" />

<div class="p-5 space-y-4">
  <div class="flex items-center gap-3">
    <h1 class="text-lg font-semibold text-[var(--text-primary)]">Scanner</h1>
    <span class="text-xs text-[var(--text-muted)]">Update families from library</span>
    <div class="flex-1"></div>
    <p-button
      label="Scan Project"
      icon="pi pi-search"
      [loading]="isScanning()"
      size="small"
      (onClick)="scan()"
    />
  </div>

  @if (isScanning()) {
    <div class="flex items-center justify-center py-16">
      <div class="flex flex-col items-center gap-2">
        <i class="pi pi-spin pi-spinner text-xl text-[var(--accent)]"></i>
        <p class="text-xs text-[var(--text-muted)]">Scanning project...</p>
      </div>
    </div>
  }

  @if (isFetchingPreview()) {
    <div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-5 flex flex-col items-center gap-2">
        <i class="pi pi-spin pi-spinner text-xl text-[var(--accent)]"></i>
        <p class="text-xs text-[var(--text-muted)]">Loading preview...</p>
      </div>
    </div>
  }

  @if (scanResult() && !isScanning()) {
    @if (summary(); as s) {
      <app-scanner-filters
        [summary]="s"
        (filterChange)="onFilterChange($event)"
      />
    }

    <app-scanner-table
      [families]="filteredFamilies()"
      [loading]="isScanning()"
      (updateSelected)="onUpdateSelected($event)"
      (updateAllAvailable)="onUpdateAllAvailable()"
      (stampSelected)="onStampSelected($event)"
    />
  }

  @if (!scanResult() && !isScanning()) {
    <div class="flex flex-col items-center justify-center py-16">
      <i class="pi pi-search text-4xl text-gray-300 mb-3"></i>
      <p class="text-sm text-[var(--text-secondary)]">Click "Scan Project" to find updatable families</p>
    </div>
  }

  @if (previewData(); as preview) {
    <app-pre-update-preview
      [visible]="true"
      [changes]="preview.changes"
      [familyName]="preview.familyName"
      (confirm)="onPreviewConfirm()"
      (cancel)="onPreviewCancel()"
    />
  }

  @if (isUpdating()) {
    <app-update-progress
      [progress]="updateProgress()"
      [visible]="isUpdating()"
    />
  }
</div>
