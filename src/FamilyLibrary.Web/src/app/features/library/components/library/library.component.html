<div class="p-5 space-y-4">
  <div class="flex items-center gap-3">
    <h1 class="text-lg font-semibold text-[var(--text-primary)] shrink-0">Library</h1>
    <span class="text-xs text-[var(--text-muted)]">{{ totalRecords() }} families</span>
    <div class="flex-1"></div>
    <div class="flex items-center gap-2">
      <p-selectbutton
        [options]="viewModeOptions"
        [(ngModel)]="viewMode"
        optionLabel="label"
        optionValue="value"
        [allowEmpty]="false"
        ariaLabel="View mode"
        size="small"
      >
        <ng-template #item let-option>
          <i [class]="option.icon"></i>
        </ng-template>
      </p-selectbutton>
    </div>
  </div>

  <app-library-filters
    [roles]="roles()"
    [categories]="categories()"
    [tags]="tags()"
    (filterChange)="onFilterChange($event)"
  />

  @if (loading()) {
    <div class="flex items-center justify-center py-16">
      <i class="pi pi-spin pi-spinner text-xl text-[var(--accent)]"></i>
    </div>
  }

  @if (!loading() && viewMode() === 'cards') {
    @if (families().length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3">
        @for (family of families(); track family.id) {
          <app-family-card
            [family]="family"
            (select)="onFamilySelect($event)"
          />
        }
      </div>
    } @else {
      <div class="flex flex-col items-center justify-center py-16 text-center">
        <i class="pi pi-inbox text-4xl text-gray-300 mb-3"></i>
        <p class="text-sm text-[var(--text-secondary)]">No families match your filters</p>
      </div>
    }
  }

  @if (!loading() && viewMode() === 'table') {
    @if (families().length > 0) {
      <div class="bg-white rounded-lg border border-[var(--border-subtle)] overflow-hidden">
        <table class="min-w-full">
          <thead>
            <tr class="border-b border-[var(--border-subtle)]">
              <th class="px-4 py-2.5 text-left text-[0.6875rem] font-medium uppercase tracking-wider text-[var(--text-muted)]">Name</th>
              <th class="px-4 py-2.5 text-left text-[0.6875rem] font-medium uppercase tracking-wider text-[var(--text-muted)]">Role</th>
              <th class="px-4 py-2.5 text-left text-[0.6875rem] font-medium uppercase tracking-wider text-[var(--text-muted)]">Version</th>
              <th class="px-4 py-2.5 text-left text-[0.6875rem] font-medium uppercase tracking-wider text-[var(--text-muted)]">Updated</th>
            </tr>
          </thead>
          <tbody>
            @for (family of families(); track family.id) {
              <tr
                class="border-b border-[#f3f4f6] hover:bg-[var(--surface-ground)] transition-colors cursor-pointer"
                (click)="onFamilySelect(family)"
              >
                <td class="px-4 py-2.5 text-[0.8125rem] font-medium text-[var(--text-primary)]">{{ family.familyName }}</td>
                <td class="px-4 py-2.5 text-[0.8125rem] text-[var(--text-secondary)]">{{ family.roleName }}</td>
                <td class="px-4 py-2.5">
                  <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[0.6875rem] font-medium bg-[var(--accent-soft)] text-[var(--accent)]">
                    v{{ family.currentVersion }}
                  </span>
                </td>
                <td class="px-4 py-2.5 text-[0.8125rem] text-[var(--text-muted)]">{{ family.updatedAt | date:'shortDate' }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="flex flex-col items-center justify-center py-16 text-center">
        <i class="pi pi-inbox text-4xl text-gray-300 mb-3"></i>
        <p class="text-sm text-[var(--text-secondary)]">No families match your filters</p>
      </div>
    }
  }

  @if (!loading() && totalRecords() > rowsPerPage()) {
    <p-paginator
      [first]="first()"
      [rows]="rowsPerPage()"
      [totalRecords]="totalRecords()"
      [rowsPerPageOptions]="[20, 50, 100]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="{first}â€“{last} of {totalRecords}"
      (onPageChange)="onPageChange($event)"
    />
  }
</div>
